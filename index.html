<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Certidão de Regularidade de Inventário</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lora:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Bibliotecas Externas -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Ícones (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <div id="app" class="app-container" :class="{ 'loading': isLoading }">
        <!-- Cabeçalho Fixo -->
        <header class="main-header">
            <div class="logo">
                <div class="logo-graphic">
                    <span class="logo-text-main">Certidão</span><span class="logo-text-pro">PRO</span>
                </div>
                <p class="comarca-text">VARA ÚNICA DA COMARCA DE NOVA RESENDE/MG</p>
            </div>
            <div class="toolbar">
                <button @click="resetForm" class="btn-tertiary" title="Nova Certidão"><i data-lucide="file-plus-2"></i> Nova</button>
                <button @click="exportState" class="btn-secondary" title="Salvar Certidão como JSON"><i data-lucide="save"></i> Salvar</button>
                <button @click="triggerFileInput" class="btn-secondary" title="Carregar Certidão de um arquivo JSON"><i data-lucide="folder-open"></i> Carregar</button>
                <input type="file" ref="fileInput" @change="importState" accept=".json" style="display: none;">
                <button @click="generatePdf" class="btn-primary" title="Gerar PDF Final"><i data-lucide="printer"></i> Gerar PDF</button>
                <span class="autosave-indicator" :class="{ 'visible': showAutosaveIndicator }">Salvo!</span>
            </div>
        </header>

        <main class="main-content">
            <!-- Painel do Formulário (Esquerda) -->
            <div class="form-panel">
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button v-for="(tab, index) in tabs" :key="index" @click="activeTab = index" :class="{ 'active': activeTab === index }">
                           <span class="tab-number">{{ index + 1 }}</span> {{ tab }}
                        </button>
                    </div>
                    <div class="tabs-content">
                        <!-- Aba 1: Dados do Processo -->
                        <div v-show="activeTab === 0" class="tab-pane">
                            <h2>1. Dados do Processo</h2>
                            <div class="form-group">
                                <label>Número do Processo <span class="required">*</span></label>
                                <input type="text" v-model="state.processo.numero" placeholder="xxxxxxx-xx.xxxx.x.xx.xxxx">
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="cumulativo" v-model="state.processo.cumulativo">
                                <label for="cumulativo">Inventário Cumulativo</label>
                            </div>
                            <fieldset>
                                <legend>Responsável pela Certidão</legend>
                                <div class="form-group">
                                    <label>Nome Completo <span class="required">*</span></label>
                                    <input type="text" v-model="state.processo.responsavel.nome" placeholder="Nome de quem emite">
                                </div>
                                <div class="form-group">
                                    <label>Cargo <span class="required">*</span></label>
                                    <select v-model="state.processo.responsavel.cargo">
                                        <option disabled value="">Selecione o cargo</option>
                                        <option>Oficial(a) Judiciário(a)</option>
                                        <option>Estagiário(a)</option>
                                        <option>Assistente Administrativo(a)</option>
                                    </select>
                                </div>
                            </fieldset>
                        </div>

                        <!-- Aba 2: Falecidos -->
                        <div v-show="activeTab === 1" class="tab-pane">
                            <h2>2. Dados dos Falecidos</h2>
                            <div v-for="(falecido, index) in state.falecidos" :key="index" class="dynamic-card">
                                <h4 class="card-title">Falecido(a) {{ index + 1 }}</h4>
                                <button @click="removeFalecido(index)" class="btn-remove" title="Remover Falecido">×</button>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>Nome Completo <span class="required">*</span></label>
                                        <input type="text" v-model="falecido.nome" placeholder="Nome do de cujus">
                                    </div>
                                    <div class="form-group">
                                        <label>Data do Falecimento <span class="required">*</span></label>
                                        <input type="date" v-model="falecido.dataFalecimento">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Documentos Pessoais (CPF/RG)</label>
                                    <input type="text" v-model="falecido.documentos" placeholder="CPF e RG">
                                </div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>ID da Certidão de Óbito <span class="required">*</span></label>
                                        <input type="text" v-model="falecido.idCertidaoObito" placeholder="ID do documento no sistema">
                                    </div>
                                    <div class="form-group">
                                        <label>Regime de Casamento</label>
                                        <select v-model="falecido.regimeCasamento">
                                            <option>Não se aplica</option>
                                            <option>Comunhão Parcial de Bens</option>
                                            <option>Comunhão Universal de Bens</option>
                                            <option>Separação Total de Bens</option>
                                            <option>Participação Final nos Aquestos</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" :id="'testamento_' + falecido.id" v-model="falecido.deixouTestamento">
                                    <label :for="'testamento_' + falecido.id">Deixou testamento?</label>
                                </div>
                            </div>
                            <button @click="addFalecido" class="btn-add"><i data-lucide="plus"></i> Adicionar Falecido</button>
                        </div>
                        
                        <!-- Aba 3: Inventariante -->
                        <div v-show="activeTab === 2" class="tab-pane">
                            <h2>3. Inventariante</h2>
                             <div class="dynamic-card">
                                <div class="form-group">
                                    <label>Nome Completo <span class="required">*</span></label>
                                    <input type="text" v-model="state.inventariante.nome">
                                </div>
                                <div class="form-group">
                                    <label>Parentesco <span class="required">*</span></label>
                                    <input type="text" v-model="state.inventariante.parentesco" placeholder="Ex: Cônjuge, Filho(a)">
                                </div>
                                <div class="form-group">
                                    <label>Documentos Pessoais (CPF/RG) <span class="required">*</span></label>
                                    <input type="text" v-model="state.inventariante.documentos">
                                </div>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>ID da Procuração</label>
                                        <input type="text" v-model="state.inventariante.idProcuracao" placeholder="ID do documento">
                                    </div>
                                    <div class="form-group">
                                        <label>ID do Termo de Compromisso <span class="required">*</span></label>
                                        <input type="text" v-model="state.inventariante.idTermoCompromisso" placeholder="ID do documento">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Aba 4: Herdeiros -->
                        <div v-show="activeTab === 3" class="tab-pane">
                            <h2>4. Herdeiros e Sucessores</h2>
                            <!-- Componente recursivo de Herdeiro/Representante -->
                            <heir-form-group
                                v-for="(herdeiro, hIndex) in state.herdeiros"
                                :key="herdeiro.id"
                                :heir="herdeiro"
                                :index="hIndex"
                                :is-representative="false"
                                @remove="removeHerdeiro(hIndex)">
                            </heir-form-group>
                            <button @click="addHerdeiro" class="btn-add"><i data-lucide="plus"></i> Adicionar Herdeiro</button>
                            <hr>
                            <!-- Renúncia de Direitos -->
                            <fieldset>
                                <legend>Renúncia de Direitos Hereditários</legend>
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="houveRenuncia" v-model="state.renuncia.houveRenuncia">
                                    <label for="houveRenuncia">Houve Renúncia de Direitos?</label>
                                </div>
                                <div v-if="state.renuncia.houveRenuncia" class="conditional-section">
                                    <h4>Herdeiros Renunciantes</h4>
                                    <div v-for="heir in state.herdeiros" :key="heir.id" class="checkbox-group-vertical">
                                        <div class="checkbox-line">
                                            <input type="checkbox" :id="'renuncia_' + heir.id" :checked="isRenunciante(heir.id)" @change="toggleRenunciante(heir.id)">
                                            <label :for="'renuncia_' + heir.id">{{ heir.nome || 'Herdeiro sem nome' }}</label>
                                        </div>
                                        <div v-if="isRenunciante(heir.id)" class="conditional-input">
                                             <div class="form-group">
                                                 <label>Tipo de Renúncia</label>
                                                 <select v-model="getRenuncia(heir.id).tipo">
                                                    <option>Abdicativa</option>
                                                    <option>Translativa</option>
                                                 </select>
                                             </div>
                                             <div class="form-group">
                                                <label>ID da Escritura/Termo de Renúncia</label>
                                                <input type="text" v-model="getRenuncia(heir.id).idEscritura" placeholder="ID do documento">
                                             </div>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <!-- Cessão de Direitos -->
                            <fieldset>
                                <legend>Cessão de Direitos Hereditários</legend>
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="houveCessao" v-model="state.cessao.houveCessao">
                                    <label for="houveCessao">Houve Cessão de Direitos?</label>
                                </div>
                                <div v-if="state.cessao.houveCessao" class="conditional-section">
                                    <div class="form-group">
                                        <label>ID da Escritura de Cessão</label>
                                        <input type="text" v-model="state.cessao.idEscritura" placeholder="ID do documento">
                                    </div>
                                    <h4>Cessionários</h4>
                                    <div v-for="(cessionario, cIndex) in state.cessao.cessionarios" :key="cIndex" class="dynamic-card sub-card">
                                        <button @click="removeCessionario(cIndex)" class="btn-remove" title="Remover Cessionário">×</button>
                                        <div class="form-group">
                                            <label>Nome do Cessionário</label>
                                            <input type="text" v-model="cessionario.nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Documentos do Cessionário</label>
                                            <input type="text" v-model="cessionario.documentos">
                                        </div>
                                        <div class="form-group">
                                            <label>Procuração do Cessionário (ID)</label>
                                            <input type="text" v-model="cessionario.idProcuracao">
                                        </div>
                                    </div>
                                    <button @click="addCessionario" class="btn-add-small"><i data-lucide="plus"></i> Adicionar Cessionário</button>
                                </div>
                            </fieldset>
                        </div>
                        
                        <!-- Aba 5: Bens e Valores -->
                        <div v-show="activeTab === 4" class="tab-pane">
                            <h2>5. Bens, Valores e Dívidas</h2>
                            <!-- Sub-seções de bens -->
                            <fieldset v-for="section in bensSections" :key="section.key">
                                <legend>{{ section.title }}</legend>
                                <div v-for="(item, index) in state.bens[section.key]" :key="index" class="dynamic-card">
                                    <button @click="removeBem(section.key, index)" class="btn-remove-small" title="Remover Item">×</button>
                                    <div v-for="field in section.fields" :key="field.model" class="form-group">
                                        <label>{{ field.label }}</label>
                                        <input v-if="!field.options" type="text" v-model="item[field.model]">
                                        <select v-else v-model="item[field.model]">
                                            <option v-for="opt in field.options" :key="opt">{{ opt }}</option>
                                        </select>
                                    </div>
                                    <div v-if="hasIncapaz && ['imoveis', 'veiculos', 'semoventes', 'outrosBens'].includes(section.key)" class="form-group checkbox-group">
                                        <input type="checkbox" :id="`avaliado_${section.key}_${index}`" v-model="item.avaliado">
                                        <label :for="`avaliado_${section.key}_${index}`">Avaliado Judicialmente</label>
                                    </div>
                                </div>
                                <button @click="addBem(section.key)" class="btn-add-small"><i data-lucide="plus"></i> Adicionar {{ section.singular }}</button>
                            </fieldset>
                            <div v-if="hasIncapaz" class="conditional-section warning">
                                <label class="bold">Avaliação de Bens para Incapazes</label>
                                <div class="form-group">
                                    <label>ID do Laudo de Avaliação Judicial</label>
                                    <input type="text" v-model="state.bens.idLaudoAvaliacaoIncapaz" placeholder="ID do documento">
                                </div>
                            </div>
                        </div>

                        <!-- Aba 6: Documentos Processuais -->
                        <div v-show="activeTab === 5" class="tab-pane">
                            <h2>6. Documentos Processuais</h2>
                             <div class="dynamic-card">
                                <!-- Primeiras Declarações -->
                                <div class="form-group">
                                    <label>Primeiras Declarações</label>
                                    <select v-model="state.documentosProcessuais.primeirasDeclaracoes.status">
                                        <option>Apresentada</option>
                                        <option>Não Apresentada</option>
                                    </select>
                                    <input v-if="state.documentosProcessuais.primeirasDeclaracoes.status === 'Apresentada'" type="text" v-model="state.documentosProcessuais.primeirasDeclaracoes.id" placeholder="ID do documento" class="conditional-input">
                                </div>
                                <hr>
                                <!-- Edital -->
                                <div class="form-group">
                                    <label>Edital</label>
                                    <select v-model="state.documentosProcessuais.edital.determinado">
                                        <option>Determinado</option>
                                        <option>Não Determinado</option>
                                    </select>
                                </div>
                                <div v-if="state.documentosProcessuais.edital.determinado === 'Determinado'" class="conditional-section">
                                    <div class="form-group">
                                        <label>Status do Edital</label>
                                        <select v-model="state.documentosProcessuais.edital.status">
                                            <option>Expedido</option>
                                            <option>Não Expedido</option>
                                        </select>
                                        <input v-if="state.documentosProcessuais.edital.status === 'Expedido'" type="text" v-model="state.documentosProcessuais.edital.id" placeholder="ID do Edital" class="conditional-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Decurso de Prazo</label>
                                        <select v-model="state.documentosProcessuais.edital.prazoDecorrido">
                                            <option>Sim</option>
                                            <option>Não</option>
                                        </select>
                                        <input v-if="state.documentosProcessuais.edital.prazoDecorrido === 'Sim'" type="text" v-model="state.documentosProcessuais.edital.idDecursoPrazo" placeholder="ID da Certidão de Decurso" class="conditional-input">
                                    </div>
                                </div>
                                <hr>
                                <!-- Últimas Declarações -->
                                <div class="form-group">
                                    <label>Últimas Declarações</label>
                                    <select v-model="state.documentosProcessuais.ultimasDeclaracoes.status">
                                        <option>Apresentada</option>
                                        <option>Não Apresentada</option>
                                    </select>
                                    <input v-if="state.documentosProcessuais.ultimasDeclaracoes.status === 'Apresentada'" type="text" v-model="state.documentosProcessuais.ultimasDeclaracoes.id" placeholder="ID do documento" class="conditional-input">
                                </div>
                                <hr>
                                <!-- Testamento / CENSEC -->
                                <div v-if="houveTestamento" class="form-group">
                                    <label>Testamento</label>
                                    <input type="text" v-model="state.documentosProcessuais.testamento.id" placeholder="ID do Testamento">
                                </div>
                                <div v-else class="form-group">
                                    <label>Certidão CENSEC</label>
                                    <input type="text" v-model="state.documentosProcessuais.censec.id" placeholder="ID da Certidão CENSEC">
                                </div>
                                <hr>
                                <!-- Sentença -->
                                <div class="form-group">
                                    <label>Sentença Homologatória</label>
                                    <select v-model="state.documentosProcessuais.sentenca.status">
                                        <option>Proferida</option>
                                        <option>Não Proferida</option>
                                    </select>
                                    <input v-if="state.documentosProcessuais.sentenca.status === 'Proferida'" type="text" v-model="state.documentosProcessuais.sentenca.id" placeholder="ID da Sentença" class="conditional-input">
                                </div>
                                <hr>
                                <!-- Trânsito em Julgado -->
                                <div class="form-group">
                                    <label>Trânsito em Julgado</label>
                                    <select v-model="state.documentosProcessuais.transito.status">
                                        <option>Ocorrido</option>
                                        <option>Não Ocorrido</option>
                                    </select>
                                    <input v-if="state.documentosProcessuais.transito.status === 'Ocorrido'" type="text" v-model="state.documentosProcessuais.transito.id" placeholder="ID da Certidão" class="conditional-input">
                                </div>
                            </div>
                        </div>

                        <!-- Aba 7: Documentação Tributária -->
                        <div v-show="activeTab === 6" class="tab-pane">
                            <h2>7. Documentação Tributária</h2>
                            <div v-if="!state.falecidos.length" class="placeholder-text">
                                Adicione um falecido na Aba 2 para ver as opções.
                            </div>
                            <div v-for="(falecido, index) in state.documentacaoTributaria" :key="index" class="dynamic-card">
                                <h4>Tributos de: <strong>{{ falecido.nomeFalecido || `Falecido ${index+1}` }}</strong></h4>
                                <div class="form-group">
                                    <label>Status do ITCD <span class="required">*</span></label>
                                    <select v-model="falecido.statusItcd">
                                        <option>Declarado e Pago</option>
                                        <option>Declarado e Parcelado</option>
                                        <option>Isento</option>
                                        <option>Não Declarado</option>
                                    </select>
                                </div>
                                <fieldset>
                                    <legend>Certidões Negativas de Débito (CND)</legend>
                                    <div class="grid-3">
                                        <div class="form-group">
                                            <label>CND Municipal</label>
                                            <select v-model="falecido.cndMunicipal.status">
                                                <option>Juntada</option>
                                                <option>Não Juntada</option>
                                            </select>
                                            <input v-if="falecido.cndMunicipal.status === 'Juntada'" type="text" v-model="falecido.cndMunicipal.id" placeholder="ID/Link" class="conditional-input">
                                        </div>
                                        <div class="form-group">
                                            <label>CND Estadual</label>
                                            <select v-model="falecido.cndEstadual.status">
                                                <option>Juntada</option>
                                                <option>Não Juntada</option>
                                            </select>
                                            <input v-if="falecido.cndEstadual.status === 'Juntada'" type="text" v-model="falecido.cndEstadual.id" placeholder="ID/Link" class="conditional-input">
                                        </div>
                                        <div class="form-group">
                                            <label>CND Federal</label>
                                            <select v-model="falecido.cndFederal.status">
                                                <option>Juntada</option>
                                                <option>Não Juntada</option>
                                            </select>
                                            <input v-if="falecido.cndFederal.status === 'Juntada'" type="text" v-model="falecido.cndFederal.id" placeholder="ID/Link" class="conditional-input">
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                             <!-- Custas Processuais -->
                            <fieldset>
                                <legend>Custas Processuais</legend>
                                <div class="form-group">
                                    <label>Situação das Custas</label>
                                    <select v-model="state.custas.situacao">
                                        <option>Ao final</option>
                                        <option>Isenção</option>
                                        <option>Devidas</option>
                                    </select>
                                </div>
                                <div v-if="state.custas.situacao === 'Devidas'" class="conditional-section">
                                    <div class="form-group">
                                        <label>Cálculo</label>
                                        <select v-model="state.custas.calculada">
                                            <option>Calculada</option>
                                            <option>Não Calculada</option>
                                        </select>
                                        <input v-if="state.custas.calculada === 'Calculada'" type="text" v-model="state.custas.idCalculo" placeholder="ID do Cálculo" class="conditional-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Pagamento</label>
                                        <select v-model="state.custas.paga">
                                            <option>Pago</option>
                                            <option>Não Pago</option>
                                        </select>
                                        <input v-if="state.custas.paga === 'Pago'" type="text" v-model="state.custas.idPagamento" placeholder="ID do Comprovante" class="conditional-input">
                                    </div>
                                </div>
                            </fieldset>
                        </div>

                        <!-- Aba 8: Observações -->
                        <div v-show="activeTab === 7" class="tab-pane">
                            <h2>8. Observações Adicionais</h2>
                            <div v-for="(obs, index) in state.observacoes" :key="index" class="dynamic-card">
                                <button @click="removeObservacao(index)" class="btn-remove" title="Remover Observação">×</button>
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>Título/Assunto</label>
                                        <input type="text" v-model="obs.titulo">
                                    </div>
                                    <div class="form-group">
                                        <label>Relevância</label>
                                        <select v-model="obs.relevancia">
                                            <option>Baixa</option>
                                            <option>Média</option>
                                            <option>Alta</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Conteúdo <span class="required">*</span></label>
                                    <textarea v-model="obs.conteudo" rows="3"></textarea>
                                </div>
                            </div>
                            <button @click="addObservacao" class="btn-add"><i data-lucide="plus"></i> Adicionar Observação</button>
                        </div>
                    </div>
                </div>

                <!-- Navegação entre Abas -->
                <div class="tab-navigation">
                    <button v-show="activeTab > 0" @click="prevTab" class="btn-nav"><i data-lucide="arrow-left"></i> Anterior</button>
                    <div class="spacer"></div>
                    <button v-show="activeTab < tabs.length - 1" @click="nextTab" class="btn-nav-primary">Próximo <i data-lucide="arrow-right"></i></button>
                </div>
            </div>

            <!-- Painel de Pré-visualização (Direita) -->
            <div class="preview-panel-container">
                <div id="preview-panel" class="preview-panel">
                    <div class="preview-header">
                        <div class="header-text">
                            <p>PODER JUDICIÁRIO DO ESTADO DE MINAS GERAIS</p>
                            <p class="comarca">VARA ÚNICA DA COMARCA DE NOVA RESENDE/MG</p>
                        </div>
                        <h1>CERTIDÃO DE REGULARIDADE</h1>
                    </div>
                    <div class="preview-content">
                        <!-- Seção de Pendências -->
                        <div class="preview-section pendencies-section" v-if="pendencies.length > 0">
                            <h3><i data-lucide="alert-triangle"></i> PENDÊNCIAS</h3>
                            <div class="preview-card">
                                <ul class="pendencies-list">
                                    <li v-for="pendency in pendencies">{{ pendency }}</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Seção 1: Dados do Processo -->
                        <div class="preview-section" v-if="state.processo.numero">
                            <h3><i data-lucide="folder-kanban"></i> 1. Dados do Processo</h3>
                            <div class="preview-card">
                                <p><strong>Número do Processo:</strong><span>{{ state.processo.numero }}</span></p>
                                <p v-if="state.processo.cumulativo"><strong>Tipo:</strong><span>Inventário Cumulativo</span></p>
                            </div>
                        </div>

                        <!-- Seção 2: Falecidos -->
                        <div class="preview-section" v-if="state.falecidos.length">
                            <h3><i data-lucide="user-minus"></i> 2. De Cujus (Falecido/a/s)</h3>
                            <div v-for="(f, i) in state.falecidos" :key="f.id" class="preview-card">
                                <p><strong>Nome:</strong><span>{{ f.nome || 'Não informado' }}</span></p>
                                <p><strong>Data do Falecimento:</strong><span>{{ formatDate(f.dataFalecimento) }}</span></p>
                                <p><strong>Certidão de Óbito (ID):</strong><span>{{ f.idCertidaoObito || 'Não informado' }}</span></p>
                            </div>
                        </div>

                        <!-- Seção 3: Inventariante -->
                        <div class="preview-section" v-if="state.inventariante.nome">
                            <h3><i data-lucide="user-check"></i> 3. Inventariante</h3>
                            <div class="preview-card">
                                <p><strong>Nome:</strong><span>{{ state.inventariante.nome }}</span></p>
                                <p><strong>Parentesco:</strong><span>{{ state.inventariante.parentesco || 'Não informado' }}</span></p>
                                <p><strong>Termo de Compromisso (ID):</strong><span>{{ state.inventariante.idTermoCompromisso || 'Não informado' }}</span></p>
                                <div v-if="state.inventariante.idProcuracao" class="info-procuracao">
                                    <p><strong>Procuração (ID):</strong><span>{{ state.inventariante.idProcuracao }}</span></p>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 4: Herdeiros -->
                        <div class="preview-section" v-if="state.herdeiros.length">
                            <h3><i data-lucide="users"></i> 4. Herdeiros e Sucessores</h3>
                            <heir-preview-group :heirs="state.herdeiros" :level="0"></heir-preview-group>
                        </div>
                        
                        <!-- Seção de Renúncia de Direitos -->
                        <div class="preview-section" v-if="state.renuncia.houveRenuncia">
                            <h3><i data-lucide="file-x-2"></i> Renúncia de Direitos</h3>
                            <div v-for="r in state.renuncia.renunciantes" :key="r.herdeiroId" class="preview-card">
                                <p><strong>Renunciante:</strong><span>{{ getHeirNameById(r.herdeiroId) }}</span></p>
                                <p><strong>Tipo de Renúncia:</strong><span>{{ r.tipo }}</span></p>
                                <p><strong>ID da Escritura/Termo:</strong><span>{{ r.idEscritura || 'Não informado' }}</span></p>
                            </div>
                        </div>

                        <!-- Seção de Cessão de Direitos -->
                        <div class="preview-section" v-if="state.cessao.houveCessao">
                            <h3><i data-lucide="arrow-right-left"></i> Cessão de Direitos</h3>
                            <div class="preview-card">
                                <p><strong>Escritura de Cessão (ID):</strong><span>{{ state.cessao.idEscritura || 'Não informado' }}</span></p>
                                <div v-for="c in state.cessao.cessionarios" class="preview-sub-card">
                                    <p><strong>Cessionário:</strong><span>{{ c.nome }}</span></p>
                                    <p><strong>Documentos:</strong><span>{{ c.documentos }}</span></p>
                                    <div v-if="c.idProcuracao" class="info-procuracao">
                                        <p><strong>Procuração (ID):</strong><span>{{ c.idProcuracao }}</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 5: Bens -->
                        <div class="preview-section" v-if="hasBens">
                            <h3><i data-lucide="gem"></i> 5. Relação de Bens, Direitos e Dívidas</h3>
                            <div v-for="section in bensSections" :key="section.key">
                                <div v-if="state.bens[section.key].length">
                                    <h4>{{ section.title }}</h4>
                                    <div v-for="(item, i) in state.bens[section.key]" :key="i" class="preview-card-small">
                                       <p v-for="field in section.fields" :key="field.model">
                                           <strong>{{ field.label }}:</strong> <span>{{ item[field.model] || 'N/A' }}</span>
                                       </p>
                                    </div>
                                </div>
                                <div v-else class="no-items-message">
                                    <p>Nenhum item da categoria "{{section.title}}" foi declarado.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Seção 6: Documentos Processuais -->
                        <div class="preview-section">
                            <h3><i data-lucide="file-text"></i> 6. Documentos Processuais</h3>
                            <div class="preview-card">
                                <p><strong>Primeiras Declarações:</strong> <span>{{ state.documentosProcessuais.primeirasDeclaracoes.status === 'Apresentada' ? `Apresentada (ID: ${state.documentosProcessuais.primeirasDeclaracoes.id || 'N/A'})` : 'Não Apresentada' }}</span></p>
                                <p><strong>Edital:</strong> <span>{{ getEditalStatus() }}</span></p>
                                <p><strong>Últimas Declarações:</strong> <span>{{ state.documentosProcessuais.ultimasDeclaracoes.status === 'Apresentada' ? `Apresentada (ID: ${state.documentosProcessuais.ultimasDeclaracoes.id || 'N/A'})` : 'Não Apresentada' }}</span></p>
                                <p v-if="houveTestamento"><strong>Testamento:</strong> <span>{{ state.documentosProcessuais.testamento.id ? `Apresentado (ID: ${state.documentosProcessuais.testamento.id})` : 'Pendente' }}</span></p>
                                <p v-else><strong>Certidão CENSEC:</strong> <span>{{ state.documentosProcessuais.censec.id ? `Apresentada (ID: ${state.documentosProcessuais.censec.id})` : 'Pendente' }}</span></p>
                                <p><strong>Sentença:</strong> <span>{{ state.documentosProcessuais.sentenca.status === 'Proferida' ? `Proferida (ID: ${state.documentosProcessuais.sentenca.id || 'N/A'})` : 'Não Proferida' }}</span></p>
                                <p><strong>Trânsito em Julgado:</strong> <span>{{ state.documentosProcessuais.transito.status === 'Ocorrido' ? `Ocorrido (ID: ${state.documentosProcessuais.transito.id || 'N/A'})` : 'Não Ocorrido' }}</span></p>
                            </div>
                        </div>

                        <!-- Seção 7: Documentação Tributária -->
                        <div class="preview-section" v-if="state.documentacaoTributaria.length || state.custas.situacao">
                            <h3><i data-lucide="landmark"></i> 7. Regularidade Tributária e Custas</h3>
                            <div v-for="(trib, i) in state.documentacaoTributaria" :key="i" class="preview-card">
                                <p><strong>Referente a:</strong><span>{{ trib.nomeFalecido }}</span></p>
                                <p><strong>Status ITCD:</strong><span>{{ trib.statusItcd }}</span></p>
                                <p><strong>CND Municipal:</strong><span>{{ trib.cndMunicipal.status === 'Juntada' ? `Juntada (ID: ${trib.cndMunicipal.id || 'N/A'})` : 'Não Juntada' }}</span></p>
                                <p><strong>CND Estadual:</strong><span>{{ trib.cndEstadual.status === 'Juntada' ? `Juntada (ID: ${trib.cndEstadual.id || 'N/A'})` : 'Não Juntada' }}</span></p>
                                <p><strong>CND Federal:</strong><span>{{ trib.cndFederal.status === 'Juntada' ? `Juntada (ID: ${trib.cndFederal.id || 'N/A'})` : 'Não Juntada' }}</span></p>
                            </div>
                             <div class="preview-card">
                                 <p><strong>Custas Processuais:</strong><span>{{ getCustasStatus() }}</span></p>
                             </div>
                        </div>

                        <!-- Seção 8: Observações -->
                        <div class="preview-section" v-if="state.observacoes.length">
                            <h3><i data-lucide="message-square-plus"></i> 8. Observações Adicionais</h3>
                            <div v-for="(obs, i) in state.observacoes" :key="i" class="preview-card">
                                <p><strong>{{ obs.titulo || 'Observação' }} (Relevância: {{ obs.relevancia }})</strong></p>
                                <p class="obs-content"><span>{{ obs.conteudo }}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="preview-footer">
                        <div class="signature-area">
                            <div class="signature-line">
                                <p class="signature-name">{{ state.processo.responsavel.nome || '_________________________________________' }}</p>
                                <p class="signature-title">{{ state.processo.responsavel.cargo || 'Cargo do Responsável' }}</p>
                            </div>
                        </div>
                        <div class="footer-info">
                            <p>Este documento foi gerado eletronicamente pelo Sistema de Gerenciamento de Certidões.</p>
                            <p>Data de Emissão: {{ emissionDate }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Overlay de Carregamento -->
        <div v-if="isLoading" class="loading-overlay">
            <div class="spinner"></div>
            <p>Gerando PDF, por favor aguarde...</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
